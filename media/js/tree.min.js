$(function(){$.ajax({type:"GET",url:"ajax.php?json=true",dataType:"json"}).done(function(a){var b=$("#tree").treeview({levels:99,data:a,showTags:true,onNodeSelected:function(d,c){$(".selected").val(c.text);$(".selected").text(c.text+" (id:"+c.id+")");$(".selected_id").val(c.id)}});$("#btn-expand-all").on("click",function(){b.treeview("expandAll",{levels:99,silent:0})});$("#btn-collapse-all").on("click",function(){b.treeview("collapseAll",{silent:0})})}).fail(function(a){console.log(a)})});function refresh(){$.ajax({async:false,type:"GET",url:"ajax.php?json=true",dataType:"json"}).done(function(a){var b=$("#tree").treeview({levels:99,data:a,showTags:true,onNodeSelected:function(d,c){$(".selected").val(c.text);$(".selected").text(c.text+" (id:"+c.id+")");$(".selected_id").val(c.id)}});$.ajax({async:false,type:"GET",url:"ajax.php?get_position_folder=true",dataType:"json",success:function(c){b.treeview("selectNode",c)}})}).fail(function(a){console.log(a)})}function message(b){if(b){var a=new Date();var d=document.getElementById("history");var c="["+a.getDate()+"-"+(a.getMonth()+1)+"-"+a.getFullYear();c+=" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"]";refresh();return d.innerHTML=c+b+"\n"+d.innerHTML}}function rename(){var b=$("input[name='id']").val();var a=$("input[name='new_name']").val();$("input[name='new_name']").select();$.post("action.php?id=rename",{id:b,new_name:a},function(c){message(c)})}function remove(){var a=$("input[name='id']").val();$.post("action.php?id=remove",{id:a},function(b){message(b)});$(".selected").val("");$(".selected").text("");$(".selected_id").val("")}function add(){var b=$("input[name='id']").val();var a=$("input[name='add_name']").val();$("input[name='add_name']").select();if($("input[name='root']").is(":checked")){b=0}$.post("action.php?id=add",{parent_id:b,add_name:a},function(c){message(c)})}function move(a){var b=$("input[name='id']").val();(a=="left")?$src="action.php?id=move_left":false;(a=="right")?$src="action.php?id=move_right":false;(a=="down")?$src="action.php?id=move_down":false;(a=="up")?$src="action.php?id=move_up":false;$.post($src,{id:b},function(c){message(c)})}document.addEventListener("keydown",function(a){(a.which=="37")?move("left"):false;(a.which=="38")?move("up"):false;(a.which=="40")?move("down"):false;(a.which=="39")?move("right"):false;(a.which=="46")?remove():false;(a.which=="36")?file_move("up"):false;(a.which=="35")?file_move("down"):false});function clear_history(){document.getElementById("history").innerHTML=""}function file_add(){var b=$("input[name='id']").val();var a=$("input[name='new_file']").val();$.post("action.php?id=file_add",{id:b,new_file:a},function(c){message(c)})}function file_remove(a){$.post("action.php?id=file_remove",{id:a},function(b){message(b)})}function file_selected(a){$("input[class='selected_file']").val(a);document.getElementById("selected_file").innerHTML=a}function file_rename(){var b=$("input[class='selected_file']").val();var a=$("input[name='file_new_name']").val();$.post("action.php?id=file_rename",{id:b,file_new_name:a},function(c){message(c)})}function file_move(b){var c=$("input[class='selected_file']").val();var a=$("input[name='id']").val();$.post("action.php?id=file_move_"+b,{id:c,folder:a},function(d){message(d)})};